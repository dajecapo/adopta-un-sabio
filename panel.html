<section class="section" id="admin-panel" style="padding: 2em; margin: 1em; border: 2px solid #a060c0; border-radius: 15px; background-color: #fff; display: none;">
  <h2>Panel de Administración de Sabios y Consultas</h2>
  <p style="color: purple; font-style: italic;">Esta sección es solo visible para el administrador.</p>
  <div id="solicitudes-pendientes"></div>
</section>

<script>
  async function actualizarEstado(rowIndex, nuevoEstado) {
    try {
      await fetch("https://script.google.com/macros/s/AKfycbzOcfcOZcbCKKfLubBtqO5hnN88esnZVTl_XXmpvWfjAKSBe4rrPvOiQlpSKCfZPw1Bkg/exec", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'update', row: rowIndex, estado: nuevoEstado })
      });
      cargarSolicitudes();
    } catch (error) {
      console.error("Error al actualizar la solicitud:", error);
    }
  }

  async function eliminarRegistro(rowIndex) {
    try {
      await fetch("https://script.google.com/macros/s/AKfycbzOcfcOZcbCKKfLubBtqO5hnN88esnZVTl_XXmpvWfjAKSBe4rrPvOiQlpSKCfZPw1Bkg/exec", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'delete', row: rowIndex })
      });
      cargarSolicitudes();
    } catch (error) {
      console.error("Error al eliminar la solicitud:", error);
    }
  }

  async function cargarSolicitudes() {
    const contenedor = document.getElementById("solicitudes-pendientes");
    try {
      const respuesta = await fetch("https://script.google.com/macros/s/AKfycbzOcfcOZcbCKKfLubBtqO5hnN88esnZVTl_XXmpvWfjAKSBe4rrPvOiQlpSKCfZPw1Bkg/exec");
      const datos = await respuesta.json();
      const pendientes = datos
        .map((s, i) => ({ ...s, index: i + 2 }))
        .filter(s => s["Estado"] && s["Estado"].toLowerCase() === "pendiente");

      if (pendientes.length === 0) {
        contenedor.innerHTML = '<p>No hay solicitudes pendientes.</p>';
        return;
      }

      contenedor.innerHTML = '';

      pendientes.forEach(s => {
        const div = document.createElement("div");
        div.classList.add("section");
        div.style.marginTop = "1em";
        const descripcion = s["Pregunta o Mini biografía"] || "(Sin descripción disponible)";

        div.innerHTML = `
          <p><strong>Nombre:</strong> ${s["Nombre completo"] || s["Nombre"]}</p>
          <p><strong>Área:</strong> ${s["Área de experiencia"] || 'Consulta'}</p>
          ${s["Años de experiencia"] ? `<p><strong>Experiencia:</strong> ${s["Años de experiencia"]} años</p>` : ''}
          ${s["Edad"] ? `<p><strong>Edad:</strong> ${s["Edad"]}</p>` : ''}
          <p><strong>Email:</strong> ${s["Email"]}</p>
          <p><strong>Teléfono:</strong> ${s["Teléfono"]}</p>
          <p><strong>Descripción:</strong> ${descripcion}</p>
          ${s["FotoURL"] ? `<img src="${s["FotoURL"]}" alt="Foto" style="border-radius: 50%; width: 150px; height: 150px;">` : ''}
          <div style="margin-top: 1em; display: flex; gap: 10px;">
            <button class="button-toggle" onclick="actualizarEstado(${s.index}, 'Aprobado')" style="background-color: green; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;">Aprobar</button>
            <button class="button-toggle" onclick="eliminarRegistro(${s.index})" style="background-color: crimson; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;">Eliminar</button>
          </div>
        `;
        contenedor.appendChild(div);
      });
    } catch (error) {
      console.error("Error al cargar las solicitudes:", error);
      contenedor.innerHTML = '<p>Error al cargar las solicitudes. Intenta más tarde.</p>';
    }
  }

  window.addEventListener('load', function () {
    if (window.location.href.includes("admin")) {
      document.getElementById("admin-panel").style.display = "block";
      cargarSolicitudes();
    }
  });
</script>
