<section class="section" id="admin-panel">
  <h2 style="text-align: center; color: #a060c0;">Panel de Administraci√≥n de Sabios y Consultas</h2>
  <p style="text-align: center; font-style: italic; color: purple;">Esta secci√≥n es solo visible para el administrador.</p>
  <div id="solicitudes-pendientes"></div>
</section>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzOcfcOZcbCKKfLubBtqO5hnN88esnZVTl_XXmpvWfjAKSBe4rrPvOiQlpSKCfZPw1Bkg/exec";

  async function actualizarEstado(row, nuevoEstado) {
    try {
      const url = `${scriptURL}?action=update&row=${row}&estado=${encodeURIComponent(nuevoEstado)}`;
      const respuesta = await fetch(url);
      const texto = await respuesta.text();
      alert(texto);
      location.reload();
    } catch (error) {
      console.error("Error al actualizar la solicitud:", error);
    }
  }

  async function eliminarRegistro(row) {
    try {
      const url = `${scriptURL}?action=delete&row=${row}`;
      const respuesta = await fetch(url);
      const texto = await respuesta.text();
      alert(texto);
      location.reload();
    } catch (error) {
      console.error("Error al eliminar la solicitud:", error);
    }
  }

  async function cargarSolicitudes() {
    const contenedor = document.getElementById("solicitudes-pendientes");
    try {
      const respuesta = await fetch(scriptURL);
      const datos = await respuesta.json();
      contenedor.innerHTML = "";

      datos.forEach((s, i) => {
        if (!s["Estado"] || s["Estado"] === "Pendiente" || s["Estado"] === "Consulta recibida") {
          const div = document.createElement("div");
          div.classList.add("section");
          div.style.marginBottom = "2em";
          div.style.border = "1px solid #ccc";
          div.style.borderRadius = "10px";
          div.style.padding = "1em";
          div.style.background = "#fdf6f0";

          div.innerHTML = `
            <p><strong>Nombre:</strong> ${s["Nombre"] || s["Nombre completo"]}</p>
            ${s["√Årea de experiencia"] ? `<p><strong>√Årea:</strong> ${s["√Årea de experiencia"]}</p>` : ""}
            ${s["A√±os de experiencia"] ? `<p><strong>Experiencia:</strong> ${s["A√±os de experiencia"]} a√±os</p>` : ""}
            ${s["Edad"] ? `<p><strong>Edad:</strong> ${s["Edad"]}</p>` : ""}
            <p><strong>Email:</strong> ${s["Email"]}</p>
            <p><strong>Tel√©fono:</strong> ${s["Tel√©fono"]}</p>
            <p><strong>Consulta / Biograf√≠a:</strong> ${s["Pregunta o Mini biograf√≠a"]}</p>
            ${s["FotoURL"] ? `<img src="${s["FotoURL"]}" alt="Foto" style="border-radius: 50%; width: 150px; height: 150px; margin-top: 1em;">` : ""}
            <div style="margin-top: 1em;">
              <button onclick="actualizarEstado(${i + 2}, 'Aprobado')" style="background-color: #28a745; color: white; border: none; border-radius: 5px; padding: 10px 15px; margin-right: 10px; cursor: pointer;">‚úÖ Aprobar</button>
              <button onclick="eliminarRegistro(${i + 2})" style="background-color: #dc3545; color: white; border: none; border-radius: 5px; padding: 10px 15px; cursor: pointer;">üóë Eliminar</button>
            </div>
          `;
          contenedor.appendChild(div);
        }
      });
    } catch (error) {
      contenedor.innerHTML = '<p style="color: red;">Error al cargar las solicitudes. Intenta m√°s tarde.</p>';
      console.error(error);
    }
  }

  document.addEventListener("DOMContentLoaded", cargarSolicitudes);
</script>
