<section class="section" id="admin-panel">
  <h2>Panel de Administración de Sabios y Consultas</h2>
  <div id="solicitudes-pendientes">
    <p>Cargando solicitudes...</p>
  </div>
</section>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzOcfcOZcbCKKfLubBtqO5hnN88esnZVTl_XXmpvWfjAKSBe4rrPvOiQlpSKCfZPw1Bkg/exec";

  async function actualizarEstado(row, nuevoEstado) {
    try {
      const url = `${scriptURL}?action=update&row=${row}&estado=${encodeURIComponent(nuevoEstado)}`;
      const respuesta = await fetch(url);
      const texto = await respuesta.text();
      alert(texto);
      location.reload();
    } catch (error) {
      console.error("Error al actualizar la solicitud:", error);
    }
  }

  async function eliminarRegistro(row) {
    try {
      const url = `${scriptURL}?action=delete&row=${row}`;
      const respuesta = await fetch(url);
      const texto = await respuesta.text();
      alert(texto);
      location.reload();
    } catch (error) {
      console.error("Error al eliminar la solicitud:", error);
    }
  }

  async function cargarSolicitudes() {
    const contenedor = document.getElementById("solicitudes-pendientes");
    try {
      const respuesta = await fetch(scriptURL);
      const datos = await respuesta.json();
      contenedor.innerHTML = "";

      datos.forEach((s, i) => {
        if (!s["Estado"] || s["Estado"] === "Pendiente" || s["Estado"] === "Consulta recibida") {
          const div = document.createElement("div");
          div.classList.add("section");
          div.innerHTML = `
            <p><strong>Nombre:</strong> ${s["Nombre"] || s["Nombre completo"]}</p>
            ${s["Área de experiencia"] ? `<p><strong>Área:</strong> ${s["Área de experiencia"]}</p>` : ""}
            ${s["Años de experiencia"] ? `<p><strong>Experiencia:</strong> ${s["Años de experiencia"]} años</p>` : ""}
            ${s["Edad"] ? `<p><strong>Edad:</strong> ${s["Edad"]}</p>` : ""}
            <p><strong>Email:</strong> ${s["Email"]}</p>
            <p><strong>Teléfono:</strong> ${s["Teléfono"]}</p>
            <p><strong>Consulta / Biografía:</strong> ${s["Pregunta o Mini biografía"]}</p>
            ${s["FotoURL"] ? `<img src="${s["FotoURL"]}" alt="Foto" class="foto-fundador" style="border-radius: 50%; width: 150px; height: 150px;">` : ""}
            <button class="button-toggle" style="background-color: green;" onclick="actualizarEstado(${i + 2}, 'Aprobado')">Aprobar</button>
            <button class="button-toggle" style="background-color: crimson;" onclick="eliminarRegistro(${i + 2})">Eliminar</button>
          `;
          contenedor.appendChild(div);
        }
      });
    } catch (error) {
      contenedor.innerHTML = '<p style="color: red;">Error al cargar las solicitudes. Intenta más tarde.</p>';
      console.error(error);
    }
  }

  window.onload = cargarSolicitudes;
</script>
