<section class="section" id="admin-panel" style="padding: 2em; margin: 1em; border: 2px solid #a060c0; border-radius: 15px; background-color: #fff; display: none;">
  <h2>Panel de Administraci√≥n de Sabios y Consultas</h2>
  <p style="color: purple; font-style: italic;">Esta secci√≥n es solo visible para el administrador.</p>
  <div id="solicitudes-pendientes"></div>
</section>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzu3dL0B_7JCeKcCmuTg5rzHCutuxVixIYwB9Eu1mJyWzEr41E02rcSqNQPzYzZMjzs/exec";

  function actualizarEstado(rowIndex, nuevoEstado) {
    fetch(`${scriptURL}?action=update&row=${rowIndex}&estado=${encodeURIComponent(nuevoEstado)}`)
      .then(response => response.text())
      .then(() => {
        alert("‚úÖ Estado actualizado correctamente.");
        cargarSolicitudes();
      })
      .catch(error => {
        alert("‚ùå Error al actualizar la solicitud.");
        console.error("Error:", error);
      });
  }

  function eliminarRegistro(rowIndex) {
    fetch(`${scriptURL}?action=delete&row=${rowIndex}`)
      .then(response => response.text())
      .then(() => {
        alert("üóëÔ∏è Solicitud eliminada correctamente.");
        cargarSolicitudes();
      })
      .catch(error => {
        alert("‚ùå Error al eliminar la solicitud.");
        console.error("Error:", error);
      });
  }

  async function cargarSolicitudes() {
    const contenedor = document.getElementById("solicitudes-pendientes");
    contenedor.innerHTML = "<p>Cargando solicitudes...</p>";
    try {
      const respuesta = await fetch(scriptURL);
      const datos = await respuesta.json();
      const pendientes = datos.map((s, i) => ({ ...s, index: i + 2 })).filter(s => (s["Estado"] || '').toLowerCase() === "pendiente");

      if (pendientes.length === 0) {
        contenedor.innerHTML = "<p>No hay solicitudes pendientes.</p>";
        return;
      }

      contenedor.innerHTML = "";

      pendientes.forEach(s => {
        const div = document.createElement("div");
        div.classList.add("section");
        div.style.marginTop = "1em";
        const descripcion = s["Pregunta o Mini biograf√≠a"] || "(Sin descripci√≥n)";
        div.innerHTML = `
          <p><strong>Nombre:</strong> ${s["Nombre completo"] || s["Nombre"]}</p>
          <p><strong>√Årea:</strong> ${s["√Årea de experiencia"] || 'Consulta'}</p>
          ${s["A√±os de experiencia"] ? `<p><strong>Experiencia:</strong> ${s["A√±os de experiencia"]} a√±os</p>` : ''}
          ${s["Edad"] ? `<p><strong>Edad:</strong> ${s["Edad"]}</p>` : ''}
          <p><strong>Email:</strong> ${s["Email"]}</p>
          <p><strong>Tel√©fono:</strong> ${s["Tel√©fono"]}</p>
          <p><strong>Descripci√≥n:</strong> ${descripcion}</p>
          ${s["FotoURL"] ? `<img src="${s["FotoURL"]}" alt="Foto" style="border-radius: 50%; width: 150px; height: 150px;">` : ''}
          <div style="margin-top: 1em; display: flex; gap: 10px;">
            <button onclick="actualizarEstado(${s.index}, 'Aprobado')" style="background-color: green; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;">Aprobar</button>
            <button onclick="eliminarRegistro(${s.index})" style="background-color: crimson; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;">Eliminar</button>
          </div>
        `;
        contenedor.appendChild(div);
      });
    } catch (error) {
      contenedor.innerHTML = "<p>‚ùå Error al cargar las solicitudes.</p>";
      console.error("Error al cargar:", error);
    }
  }

  window.addEventListener("load", function () {
    if (window.location.href.includes("admin")) {
      document.getElementById("admin-panel").style.display = "block";
      cargarSolicitudes();
    }
  });
</script>
